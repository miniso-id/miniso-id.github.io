<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MMS-X</title>

<link rel="stylesheet" href="style.css">
<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>

<style>
/* ===== CAMERA ===== */
#reader{
  display:none;
  width:100%;
  max-width:360px;
  aspect-ratio:1/1;
  margin:10px auto;
  background:#000;
  border-radius:12px;
  overflow:hidden;
  position:relative;
}
#reader video{
  width:100%;
  height:100%;
  object-fit:cover;
}
#reader::after{
  content:"";
  position:absolute;
  inset:22%;
  border:2px dashed rgba(0,255,0,.7);
  border-radius:8px;
}

/* =========================
   LOGIN ADDITION (NEW)
   ========================= */
#loginOverlay{
  position:fixed;
  inset:0;
  background:#f4f6fb;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  font-family:system-ui;
}
.login-card{
  width:100%;
  max-width:360px;
  padding:28px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
  text-align:center;
}
.login-card h3{margin-bottom:22px}
.login-card input{
  width:100%;
  height:44px;
  padding:0 14px;
  margin-bottom:14px;
  border-radius:10px;
  border:1px solid #dcdcdc;
  font-size:15px;
}
.login-card button{
  width:100%;
  height:46px;
  border:none;
  border-radius:10px;
  background:#4f46e5;
  color:#fff;
  font-size:15px;
  cursor:pointer;
}

/* error animation */
.login-card.error{animation:shake .35s ease}
.login-card.error input{border-color:#ef4444}
@keyframes shake{
  0%{transform:translateX(0)}
  20%{transform:translateX(-6px)}
  40%{transform:translateX(6px)}
  60%{transform:translateX(-4px)}
  80%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}
#loginErr{
  min-height:18px;
  font-size:14px;
  color:#ef4444;
  opacity:0;
  transform:translateY(-4px);
  transition:.25s;
}
#loginErr.show{
  opacity:1;
  transform:translateY(0);
}
</style>
</head>

<body>

<!-- =========================
     LOGIN ADDITION (NEW)
     ========================= -->
<div id="loginOverlay">
  <div class="login-card">
    <h3>Login MMS-X</h3>
    <input id="loginUser" placeholder="Username">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="doLogin()">Masuk</button>
    <div id="loginErr"></div>
  </div>
</div>

<!-- APP (ASLI â€” TIDAK DIUBAH) -->
<div id="app">


<h2>Product Query</h2>
  <h3>MMS-X (beta test)</h3>

<div class="search-box">
  <div class="input-wrap">
    <input id="searchInput" placeholder="Scan barcode / type here" autofocus>
    <span id="clearBtn">âœ•</span>
  </div>
  <button id="scanBtn">ðŸ“· Camera Scan</button>
</div>

<div id="reader"></div>

<h3>Scan History</h3>
<div id="history"></div>

<div id="result" class="grid"></div>

<audio id="beepOk" src="https://assets.mixkit.co/sfx/preview/mixkit-confirmation-tone-2867.mp3"></audio>
<audio id="beepErr" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>

</div>

<!-- =========================
     LOGIN SCRIPT (NEW)
     ========================= -->
<script>
const USERS=[
  {user:"admin",pass:"admin123"},
  {user:"staff",pass:"1234"}
]

const overlay=document.getElementById("loginOverlay")
const card=document.querySelector(".login-card")

function checkLogin(){
  if(localStorage.getItem("mms_login")==="1"){
    overlay.style.display="none"
  }else{
    overlay.style.display="flex"
  }
}

function doLogin(){
  const u=loginUser.value.trim()
  const p=loginPass.value.trim()
  const ok=USERS.find(x=>x.user===u && x.pass===p)

  if(ok){
    localStorage.setItem("mms_login","1")
    overlay.style.display="none"
  }else{
    loginErr.innerText="Username atau password salah"
    loginErr.classList.add("show")
    card.classList.remove("error")
    void card.offsetWidth
    card.classList.add("error")
  }
}

loginUser.oninput=loginPass.oninput=()=>{
  loginErr.classList.remove("show")
  card.classList.remove("error")
}

checkLogin()
</script>

<!-- =========================
     SCRIPT ASLI (TIDAK DIUBAH)
     ========================= -->
<script>
/* =====================================================
   INIT
   ===================================================== */
const input=document.getElementById("searchInput");
const clearBtn=document.getElementById("clearBtn");
const reader=document.getElementById("reader");
const historyDiv=document.getElementById("history");
const result=document.getElementById("result");
input.focus();

/* =====================================================
   DATA
   ===================================================== */
let barcodeInde
